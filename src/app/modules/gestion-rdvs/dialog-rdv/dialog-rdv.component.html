<!-- <div style="pointer-events: none; opacity: 0.3; width: 100%; height: 100%; z-index: 1;">
  Chargement en cours
</div> -->

<div class="dialog" [ngClass]="{ loader: spinnerGetData }">
  <div
    class="grid grid-cols-3 gap-4 bg-[#E9E9E9] rounded-[12px_12px_0px_0px] p-4"
  >
    <h1 mat-dialog-title class="col-span-2">{{ button }} type d'activité</h1>
    <div class="text-right cursor-pointer" mat-button mat-dialog-close>
      <mat-icon>close</mat-icon>
    </div>
  </div>
  <div mat-dialog-content>
    <form class="mt-7 mb-7" [formGroup]="createTask">
      <div class="grid grid-cols-1 pl-7 pr-7 mb-6" *ngIf="typeForm == 'ADD'">
        <mat-radio-group
          aria-label="Select an option"
          name="type"
          (change)="onChange($event)"
        >
          <mat-radio-button value="RDV" [checked]="typeActivity == 'RDV'"
            >RDV</mat-radio-button
          >
          <mat-radio-button value="Task" [checked]="typeActivity == 'Task'"
            >Tâche</mat-radio-button
          >
        </mat-radio-group>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <!-- <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4"> -->
          <!-- <mat-label>Objet</mat-label>
                      <input matInput type="text" formControlName="subject" autocomplete="off"/> -->
          <i-field
            [type]="'text'"
            [label]="'Titre'"
            formControlName="subject"
          ></i-field>
          <!-- </mat-form-field> -->
        </div>
        <div *ngIf="typeForm == 'EDIT' && typeActivity == 'RDV'">
          <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4">
            <mat-label>Statut</mat-label>
            <mat-select
              formControlName="status"
              (selectionChange)="statutRdv($event)"
            >
              <mat-option value="Planifié"> Planifié </mat-option>
              <mat-option value="Honoré"> Honoré </mat-option>
              <mat-option value="Non Honoré"> Non Honoré </mat-option>
              <mat-option value="Annulé"> Annulé </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div *ngIf="typeForm == 'EDIT' && typeActivity == 'Task'">
          <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4">
            <mat-label>Statut</mat-label>
            <mat-select formControlName="status">
              <mat-option value="A faire"> A faire </mat-option>
              <mat-option value="En cours"> En cours </mat-option>
              <mat-option value="Termine"> Termine </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <i-field
            [type]="'datetime-local'"
            [maxValue]="end_time"
            [label]="'Date début'"
            formControlName="startTime"
            (changeValue)="setDateDebut($event)"
          ></i-field>
        </div>
        <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <i-field
            [type]="'datetime-local'"
            [minValue]="start_time"
            [label]="'Date fin'"
            formControlName="endTime"
            (changeValue)="setDateFin($event)"
          ></i-field>
        </div>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <i-field
            [type]="'text'"
            [label]="'Lieu'"
            formControlName="location"
          >
        </i-field>
        <i class="pi pi-map-marker icon-map" (click)="openDialogMaps()"></i>
        <!-- <mat-icon >filter</mat-icon> -->
        </div>
        <!-- <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4">
            <mat-label>Lieu</mat-label>
            <input matInput type="text" formControlName="location" autocomplete="off"/>

          </mat-form-field> -->
        <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4">
          <mat-label>Assigné à</mat-label>
          <mat-select formControlName="user_id">
            <!-- <mat-option [value]="userAuth"> To me </mat-option> -->
            <!-- <mat-option [value]="userAuth.id"> {{ userAuth.name}} </mat-option> -->
            <mat-option *ngFor="let item of user" [value]="item.id">
              {{ item.first_name }} {{ item.last_name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <div>
          <div class="w-[100%] pl-7 pr-7 mb-4">
            <app-shared-autcomplete
              #searchComponent1
              [hasIcon]="false"
              [opended] = "true"
              [type]="'single'"
              [contentStyle]="contentStyle"
              [inputStyle]="searchStyle"
              [charToGetAll]="'*'"
              [apiUrl]="apiUri"
              [keys]="['code', 'first_name', 'last_name', 'name']"
              [lengthToStart]="3"
              [display]="['code', 'name']"
              [placeholer]="''"
              [label]="'Rechercher le client/prospect...'"
              (dataEvent)="onClientChange($event)"
            ></app-shared-autcomplete>
          </div>
          <!-- 'first_name', 'last_name', -->
        </div>
        <div>
          <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4">
            <mat-label>Importance</mat-label>
            <mat-select formControlName="priority">
              <mat-option value="Urgent"> Urgent </mat-option>
              <mat-option value="Normal"> Normal </mat-option>
              <mat-option value="Faible"> Faible </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <i-field
            [type]="'textarea'"
            [label]="'Description'"
            formControlName="description"
            [cols]="30"
            [rows]="6"
            maxlength="500"
            (input)="setMaxSize($event)"
          ></i-field>
          <div class="text-right" style="margin-top: 1%; margin-right: 1%;">{{maxSize}}/500</div>
        </div>
        <!-- <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <i-field
            [type]="'datetime-local'"
            [maxValue]="end_time"
            [label]="'Date début'"
            formControlName="startTime"
            (changeValue)="setDateDebut($event)"
          ></i-field>
        </div> -->
        <div >
          <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4" *ngIf="typeActivity == 'RDV'">
            <mat-label>Type</mat-label>
            <mat-select formControlName="type">
              <mat-option [value]="type.libelle" *ngFor="let type of types">
                {{ type.libelle }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <!-- <label for="piece-jointe"><i class="pi pi-download"></i></label> -->
          <input type="file" class="piece-jointe" (change)="onSelectFile($event)"/>
          <div *ngIf="activity.file" class="text-right cursor-pointer" style="margin-right: 30px;">
            <a href="{{ url + activity.id + '/' }}{{ activity.file }} " target="_blank">
              <mat-icon class="text-[12px]" style="margin: 5px 5px;">filter</mat-icon>
              Voir piéce jointe
            </a>
            <a (click)="deletPJ()" class="text-red-600">
              <mat-icon class="text-[12px]" style="margin: 5px 5px;">delete</mat-icon>
              Supprimer piéce jointe
            </a>
            <!-- <mat-icon class="text-[12px]" style="margin: 5px 5px;">delete</mat-icon> -->
          </div>

        </div>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <div *ngIf="typeForm == 'EDIT' && typeActivity == 'RDV' && motif">
          <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4 motifdialog" >
            <!-- <div style="background-color: #3ed20c5c;"> -->
              <mat-label>Motif</mat-label>
              <mat-select formControlName="motif" >
                <mat-option [value]="motif.name" *ngFor="let motif of motifs"> {{ motif.name }} </mat-option>
              </mat-select>
            <!-- </div> -->
          </mat-form-field>
        </div>

        <!-- <div
          class="w-[100%] pl-7 pr-7 mb-4 relative"
          *ngIf="typeForm == 'EDIT' && typeActivity == 'RDV' && motif"
        >
          <mat-form-field appearance="fill">
            <mat-label>Motif</mat-label>
            <mat-select formControlName="motif">
              <mat-option [value]="motif.name" *ngFor="let motif of motifs"> {{ motif.name }} </mat-option>
            </mat-select>
          </mat-form-field>
          <i-field
            [inputStyle]="{'background-color': '#3ed20c5c'}"
            [type]="'text'"
            [label]="'Motif'"
            formControlName="motif"
          ></i-field>
        </div> -->
      </div>
    </form>
  </div>
  <div class="grid grid-cols-2 gap-4 mt-5 mb-5 p-4">
    <div>
      <button
        class="underline w-32 p-4 mr-3 font-bold text-[18px]"
        mat-dialog-close
      >
        Abandonner
      </button>
    </div>
    <div class="text-right">
      <button
        class="bg-[#0C8040] text-[#fff] border-[#0C8040] rounded-[28px] shadow-[0px_3px_6px_#00000029] w-40 p-4 ml-9 mt-5 font-bold text-[18px]"
        type="submit"
        (click)="addActivity()"
        *ngIf="!spinner"
      >
        {{ button }}</button
      ><!-- [disabled]="createTask.invalid" -->
      <span *ngIf="spinner">
        <mat-spinner [diameter]="40"></mat-spinner>
      </span>
    </div>
  </div>
</div>
