<div class="dialog" [ngClass]="{ 'loader': spinnerGetData }">
  <div
    class="grid grid-cols-3 gap-4 bg-[#E9E9E9] rounded-[12px_12px_0px_0px] p-4"
  >
    <h1 mat-dialog-title class="col-span-2">Modification d'un rendez-vous</h1>
    <div class="text-right cursor-pointer" mat-button mat-dialog-close>
      <mat-icon>close</mat-icon>
    </div>
  </div>
  <div mat-dialog-content>
    <form class="mt-7 mb-7" [formGroup]="createTask">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <!-- <div>
          <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4">
            <mat-label>Objet</mat-label>
            <input matInput type="text" formControlName="subject" autocomplete="off"/>
          </mat-form-field>
        </div> -->
        <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <i-field [type]="'text'" [label]="'Titre'" formControlName="subject" ></i-field>
      </div>
        <div>
          <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4">
            <mat-label>Statut</mat-label>
            <mat-select formControlName="status" (selectionChange)="statutRdv($event)">
              <mat-option value="Planifié"> Planifié </mat-option>
              <mat-option value="Honoré"> Honoré </mat-option>
              <mat-option value="Non Honoré"> Non Honoré </mat-option>
              <!--<mat-option value="Reporte"> Reporte </mat-option>-->
              <mat-option value="Annulé"> Annulé </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <!-- <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <label
            class="absolute top-[-7px] left-[40px] bg-white pl-[10px] pr-[10px] text-[#a7a7a7]"
            >Date début</label
          >
          <input
            type="datetime-local"
            formControlName="startTime"
            (change)="setDateDebut($event)"
            [max]="end_time"
            class="border-[3px] border-[#DBDBDB] rounded-[28px] w-[100%] p-4"
          />
        </div>
        <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <label
            class="absolute top-[-7px] left-[40px] bg-white pl-[10px] pr-[10px] text-[#a7a7a7]"
            >Date Fin</label
          >
          <input
            type="datetime-local"
            formControlName="endTime"
            (change)="setDateFin($event)"
            [min]="start_time"
            class="border-[3px] border-[#DBDBDB] rounded-[28px] w-[100%] p-4"
          />
        </div> -->
        <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <i-field [type]="'datetime-local'" [maxValue]="end_time" [label]="'Date début'" formControlName="startTime" (changeValue)="setDateDebut($event)" ></i-field>
        </div>
        <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <i-field [type]="'datetime-local'" [minValue]="start_time" [label]="'Date Fin'" formControlName="endTime" (changeValue)="setDateFin($event)" ></i-field>
        </div>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <!-- <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4">
          <mat-label>Lieu</mat-label>
          <input matInput type="text" formControlName="location" autocomplete="off"/>
        </mat-form-field> -->
        <div class="w-[100%] pl-7 pr-7 mb-4 relative">

          <i-field [type]="'text'" [label]="'Lieu'" formControlName="location" ></i-field>
          <i class="pi pi-map-marker icon-map" (click)="openDialogMaps()"></i>
        </div>
        <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4" >
          <mat-label>Assigné à</mat-label>
          <mat-select formControlName="user_id" >
            <!-- <mat-option [value]="personnelID(userAuth)"> {{ userAuth.name}} </mat-option> -->
            <mat-option *ngFor="let item of user" [value]="item.id">
              {{ item.first_name }} {{ item.last_name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <div>
          <div class="w-[100%] pl-7 pr-7 mb-4">
            <app-shared-autcomplete
              #searchComponent1
              [hasIcon] = false
              [opended] = "true"
              [type]="'single'"
              [contentStyle]="contentStyle"
              [inputStyle]="searchStyle"
              [charToGetAll]="'*'"
              [apiUrl]="apiUri"
              [keys]="['code', 'first_name', 'last_name', 'name']"
              [lengthToStart]="3"
              [display]="['code', 'name']"
              [placeholer]="'Rechercher le client/prospect...'"
              (dataEvent)="onClientChange($event)">
          </app-shared-autcomplete>
          </div>
          <!-- <div>
            <mat-form-field class="w-[100%] pl-7 pr-7 mb-4" appearance="fill">
              <mat-label>Client</mat-label>
              <mat-select formControlName="customer_id" >
                <mat-option *ngFor="let option of client" [value]="option.id">
                  {{ option.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div> -->
        </div>
        <div>
          <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4">
            <mat-label>Importance</mat-label>
            <mat-select formControlName="priority">
              <mat-option value="Urgent"> Urgent </mat-option>
              <mat-option value="Normal"> Normal </mat-option>
              <mat-option value="Faible"> Faible </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <i-field
          [type]="'textarea'"
          [label]="'Description'"
          formControlName="description"
          [cols]="30"
          [rows]="6"
          maxlength="500"
          (input)="setMaxSize($event)"
        ></i-field>
        <div class="text-right" style="margin-top: 1%; margin-right: 1%;">{{maxSize}}/500</div>
        </div>
        <div>
          <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4">
            <mat-label>Type</mat-label>
            <mat-select formControlName="type">
              <mat-option [value]="type.libelle" *ngFor="let type of types"> {{ type.libelle }} </mat-option>
            </mat-select>
          </mat-form-field>
          <input type="file" class="piece-jointe" (change)="onSelectFile($event)"/>
          <div *ngIf="task.file" class="text-right cursor-pointer" style="margin-right: 30px;">
            <a href="{{ url + task.id + '/' }}{{ task.file }} " target="_blank">
              <mat-icon class="text-[12px]" style="margin: 5px 5px;">filter</mat-icon>
              Voir piéce jointe
            </a>
            <a (click)="deletPJ()" class="text-red-600">
              <mat-icon class="text-[12px]" style="margin: 5px 5px;">delete</mat-icon>
              Supprimer piéce jointe
            </a>
            <!-- <mat-icon class="text-[12px]" style="margin: 5px 5px;">delete</mat-icon> -->
          </div>
        </div>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
          <!-- <i-field
              [inputStyle]="{'background-color': '#3ed20c5c'}"
              [type]="'text'"
              [label]="'Motif'"
              formControlName="motif"
              bg-lime-500
            ></i-field> -->
        <div *ngIf="motif">
          <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4 motifdialog">
            <mat-label>Motif</mat-label>
            <mat-select formControlName="motif">
              <mat-option [value]="motif.name" *ngFor="let motif of motifs"> {{ motif.name }} </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
    </form>
  </div>
  <div class="grid grid-cols-2 gap-4 mt-5 mb-5 p-4">
    <div>
      <button
        class="underline w-32 p-4 mr-3 font-bold text-[18px]"
        mat-dialog-close
      >
        Abondonner
      </button>
    </div>
    <div class="text-right">
      <button
        class="bg-[#0C8040] text-[#fff] border-[#0C8040] rounded-[28px] shadow-[0px_3px_6px_#00000029] w-40 p-4 ml-9 mt-5 font-bold text-[18px]"
        type="submit"
        (click)="editTask()"
        *ngIf="!spinner"
      >
        Modifier
      </button>
      <span *ngIf="spinner">
        <mat-spinner [diameter]="40"></mat-spinner>
      </span>
    </div>
  </div>
</div>
