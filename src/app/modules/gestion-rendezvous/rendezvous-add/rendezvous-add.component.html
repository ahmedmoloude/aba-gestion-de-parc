<div class="dialog" [ngClass]="{ loader: spinnerGetData }">
  <div
    class="grid grid-cols-3 gap-4 bg-[#E9E9E9] rounded-[12px_12px_0px_0px] p-4"
  >
    <h1 mat-dialog-title class="col-span-2">Ajout d'un rendez-vous</h1>
    <div class="text-right cursor-pointer" mat-button mat-dialog-close>
      <mat-icon>close</mat-icon>
    </div>
  </div>
  <div mat-dialog-content>
    <form class="mt-7 mb-7" [formGroup]="createTask">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <!-- <div>
          <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4">
            <mat-label>Objet</mat-label>
            <input matInput type="text" formControlName="subject" autocomplete="off"/>
          </mat-form-field>
        </div> -->
        <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <i-field
            [type]="'text'"
            [label]="'Titre'"
            formControlName="subject"
          ></i-field>
        </div>
        <!-- <div>
          <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4">
            <mat-label>Lieu</mat-label>
            <input matInput type="text" formControlName="location" autocomplete="off"/>
          </mat-form-field>
        </div> -->
        <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <i-field [type]="'text'" [label]="'Lieu'" formControlName="location" ></i-field>
          <i class="pi pi-map-marker icon-map" style="margin: 5px 5px;" (click)="openDialogMaps()"></i>
        </div>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <!-- <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <label
            class="absolute top-[-7px] left-[40px] bg-white pl-[10px] pr-[10px] text-[#a7a7a7]"
            >Date début</label
          >
          <input
            type="datetime-local"
            formControlName="startTime"
            (change)="setDateDebut($event)"
            [max]="end_time"
            class="border-[3px] border-[#DBDBDB] rounded-[28px] w-[100%] p-4"
          />
        </div>
        <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <label
            class="absolute top-[-7px] left-[40px] bg-white pl-[10px] pr-[10px] text-[#a7a7a7]"
            >Date Fin</label
          >
          <input
            type="datetime-local"
            formControlName="endTime"
            (change)="setDateFin($event)"
            [min]="start_time"
            class="border-[3px] border-[#DBDBDB] rounded-[28px] w-[100%] p-4"
          />
        </div> -->
        <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <i-field
            [type]="'datetime-local'"
            [maxValue]="end_time"
            [label]="'Date début'"
            formControlName="startTime"
            (changeValue)="setDateDebut($event)"
          ></i-field>
        </div>
        <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <i-field
            [type]="'datetime-local'"
            [minValue]="start_time"
            [label]="'Date Fin'"
            formControlName="endTime"
            (changeValue)="setDateFin($event)"
          ></i-field>
        </div>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <div class="w-[100%] pl-7 pr-7 mb-4">
          <app-shared-autcomplete
            #searchComponent1
            [hasIcon]="false"
            [opended] = "true"
            [type]="'single'"
            [contentStyle]="contentStyle"
            [inputStyle]="searchStyle"
            [charToGetAll]="'*'"
            [apiUrl]="apiUri"
            [keys]="['code', 'first_name', 'last_name', 'name']"
            [lengthToStart]="3"
            [display]="['code', 'name']"
            [placeholer]="'Rechercher le client/prospect...'"
            (dataEvent)="onClientChange($event)"
          ></app-shared-autcomplete>
        </div>
        <!-- <div>
          <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4">
            <mat-label>Client</mat-label>
            <mat-select formControlName="customer_id">
              <mat-option *ngFor="let item of client" value="{{ item.id }}">
                {{ item.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div> -->
        <div>
          <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4">
            <mat-label>Importance</mat-label>
            <mat-select formControlName="priority">
              <mat-option value="Urgent"> Urgent </mat-option>
              <mat-option value="Normal"> Normal </mat-option>
              <mat-option value="Faible"> Faible </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <div>
          <mat-form-field class="w-[100%] pl-7 pr-7 mb-4" appearance="fill">
            <mat-select formControlName="user_id">
              <!-- <mat-option *ngIf="nbUser == 0"> No data </mat-option> -->
              <!-- <mat-option [value]="userAuth.id"> {{ userAuth.name}} </mat-option> -->
              <mat-option *ngFor="let option of user" [value]="option.id">
                {{ option.first_name }} {{ option.last_name }}
              </mat-option>
            </mat-select>
            <mat-label>Assigné à</mat-label>
          </mat-form-field>
        </div>
        <div>
          <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4">
            <mat-label>Type</mat-label>
            <!-- <mat-select formControlName="type">
              <mat-option value="Call"> Appel </mat-option>
              <mat-option value="Visite"> Visite </mat-option>
              <mat-option value="Videoconference">
                Video Conference
              </mat-option>
            </mat-select> -->
            <mat-select formControlName="type">
              <mat-option [value]="type.libelle" *ngFor="let type of types"> {{ type.libelle }} </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <div class="w-[100%] pl-7 pr-7 mb-4 relative">
          <i-field
            [type]="'textarea'"
            [label]="'Description'"
            formControlName="description"
            [cols]="30"
            [rows]="6"
            maxlength="500"
            (input)="setMaxSize($event)"
          ></i-field>
          <div class="text-right" style="margin-top: 1%; margin-right: 1%;">{{maxSize}}/500</div>
        </div>
        <div>
          <input type="file" class="piece-jointe" (change)="onSelectFile($event)"/>
          <!-- <div *ngIf="activity.file" class="text-right" style="margin-right: 30px;">
            <a href="{{ url + activity.id + '/' }}{{ activity.file }} " target="_blank">
              <mat-icon class="text-[12px]" style="margin: 5px 5px;">filter</mat-icon>Voir piéce jointe</a>
          </div> -->
        </div>
      </div>
    </form>
  </div>
  <div class="grid grid-cols-2 gap-4 mt-5 mb-5 p-4">
    <div>
      <button
        class="underline w-32 pt-2 mr-3 font-bold text-[18px]"
        mat-dialog-close
      >
        Abandonner
      </button>
    </div>
    <div class="text-right">
      <!-- <button
        class="bg-[#0C8040] text-[#fff] border-[#0C8040] rounded-[28px] shadow-[0px_3px_6px_#00000029] w-40 p-4 ml-9 mt-5 font-bold text-[18px]"
        type="submit"
        [disabled]="createTask.invalid"
        (click)="addTask()"
        *ngIf="!spinner"
      >
        Enregistrer
      </button> -->
          <button
            [disabled]="createTask.invalid"
            *ngIf="!spinner"
            (click)="addTask()"
            pButton pRipple
            type="submit"
            label="Enregistrer"
            class="p-button-rounded p-button-success">
          </button>
      <span *ngIf="spinner">
        <mat-spinner [diameter]="40"></mat-spinner>
      </span>
    </div>
  </div>
</div>
