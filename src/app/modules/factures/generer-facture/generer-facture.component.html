<div
  class="bg-[#fff] shadow-[0px_3px_30px_#00000029] rounded-[20px] ml-6 mr-6 p-6 vehiculetabs">
  <div class="grid grid-cols-1 gap-2">
    <div class="flex">
      <mat-icon class="pt-[5px]">assignment</mat-icon>
      <h2 class="text-[#636363] font-semibold pl-2">
        Factures > <span class="text-[#0C8040] pl-2">Visualisation détaillée</span>
      </h2>
    </div>
  </div>
  <div *ngIf="bill$ | async as factureState">
    <div  *ngIf="factureState?.dataState =='Loading'" class="flex items-center justify-center mt-6">
      <mat-spinner [diameter]="80"></mat-spinner>
    </div>
    <div *ngIf="factureState?.facture && factureState?.dataState =='Success'">
      <div class="grid grid-cols-4 gap-4 mb-3">
        <div>
          <div class="w-full" #myComponent>
            <div class="relative">
                <span  class="label show-label">ID / Nom de client:</span>
                <input type="text" class="input block w-full p-2 border-[#DBDBDB]" [value]="factureState?.facture?.customer?.name || '---'"  readonly/>
            </div>
          </div>
        </div>
        <div>
          <div class="w-full" #myComponent>
            <div class="relative">
                <span  class="label show-label">Numéro d'envoie::</span>
                <input type="text" class="input block w-full p-2 border-[#DBDBDB]" [value]="factureState?.facture?.reference || '---'"  readonly/>
            </div>
          </div>
        </div>
        <div>
          <div class="w-full" #myComponent>
            <div class="relative">
                <span  class="label show-label">Période:</span>
                <input type="text" class="input block w-full p-2 border-[#DBDBDB]"
                value=" Du {{(factureState?.facture?.start_date | date :'dd/MM/yyyy' || '---')}} - Au {{(factureState?.facture?.end_date | date :'dd/MM/yyyy' || '---')}}"  readonly/>
            </div>
          </div>
        </div>
      </div>
      <ng-container *ngIf="factureState?.facture?.expeditions?.length>0">
        <table class="w-full text-left text-gray-500 block overflow-auto">
          <thead>
            <tr>
              <th
                *ngFor="let header of headerColumuns"
                scope="col"
                class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
                <div class="flex items-center">
                  {{ header }}
                </div>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr
              class="table-row bg-white whitespace-nowrap border-b border-gray-800"
              *ngFor="let expedition of factureState?.facture?.expeditions">
              <td class="p-3">{{(expedition?.created_at | date :'dd/MM/yyyy' || '---')}}</td>
              <td class="p-3">{{expedition?.reference || '---'}}</td>
              <td class="p-3">{{expedition?.declaration_code || '---'}}</td>
              <td class="p-3">{{expedition?.customer?.name || '---'}}</td>
              <td class="p-3">{{expedition?.destination_agency?.name || '---'}}</td>
              <td class="p-3">{{expedition?.receiver?.name || '---'}}</td>
              <td class="p-3">{{sumExpeditionItemsProperties(expedition?.expedition_items).number || 0}}</td>
              <td class="p-3">{{sumExpeditionItemsProperties(expedition?.expedition_items).weight || 0}}</td>
              <td class="p-3">{{sumExpeditionItemsProperties(expedition?.expedition_items).declared_value || 0}}</td>
              <td class="p-3">{{expedition?.type_livraison =='agence' ? 'gare' : 'domicile'}}</td>
              <td class="p-3">{{expedition?.nature || '---'}}</td>
              <td class="p-3">{{sumAmounts(expedition?.return_funds_amounts) || 0}}</td>
              <td class="p-3">{{getDocumentsByTypeCount(expedition?.return_documents, 'BL') ? getDocumentsByTypeCount(expedition?.return_documents, 'BL') : 0}}</td>
              <td class="p-3">{{getDocumentsByTypeCount(expedition?.return_documents, 'Facture') ? getDocumentsByTypeCount(expedition?.return_documents, 'Facture') : 0}}</td>
              <td class="p-3">{{expedition?.mode_port || '---'}}</td>
              <td class="p-3">{{sumTarifDetails(expedition?.expedition_tarif_details).htTotal | number}}</td>
              <td class="p-3">{{getTransportTarifs(expedition?.expedition_tarif_details).ht | number}}</td>
              <td class="p-3">{{sumTarifDetails(expedition?.expedition_tarif_details).ht | number}}</td>
              <td class="p-3">{{getTransportTarifs(expedition?.expedition_tarif_details).tva | number}}</td>
              <td class="p-3">{{sumTarifDetails(expedition?.expedition_tarif_details).tva | number}}</td>
              <td class="p-3">{{sumTarifDetails(expedition?.expedition_tarif_details).ttcTotal | number}}</td>
            </tr>
          </tbody>
        </table>
      </ng-container>
    </div>
  </div>
</div>
