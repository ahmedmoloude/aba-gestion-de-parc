<div class="bg-[#fff] shadow-[0px_3px_30px_#00000029] rounded-[20px] ml-6 mr-6 p-6">
  <div class="grid grid-cols-2 gap-2">
    <div class="flex justify-between">
      <div class="flex">
        <mat-icon class="pt-[5px]">local_shipping</mat-icon>
        <h2 class="text-[#0C8040] font-semibold pl-2">Liste des cartes</h2>
      </div>
    </div>

    <div class="flex justify-end">
      <div class="flex cursor-pointer mr-4">
        <mat-icon class="pt-[5px]">cloud_download</mat-icon>
        <h2 class="text-[#0C8040] font-semibold pl-2" (click)="exportExcel()">Exporter</h2>
      </div>
      <div class="flex cursor-pointer" *ngIf="permissionService.hasPermission('Gestion de parc', 'Liste des cartes', 'C')">
        <mat-icon class="pt-[5px]">add_circle</mat-icon>
        <h2 class="text-[#0C8040] font-semibold pl-2" (click)="ajouter('add', '')">Ajouter</h2>
      </div>
    </div>
  </div>

  <div class="grid">
    <app-shared-filter [inputs]="inputsFiler" [extraInputs]="extraInputsFilter"
      (filter)="filter($event)"></app-shared-filter>
  </div>

  <div *ngIf="spinner" class="flex items-center justify-center mt-6 mb-6">
    <mat-spinner [diameter]="50"></mat-spinner>
  </div>

  <div class="mt-10" *ngIf="!spinner">
    <div class="mt-36 mb-36 text-center" *ngIf="cartes.length == 0 ">
      <p class="text-[#636363] text-[22px]">La Liste des cartes est vide</p>
    </div>
    <div *ngIf="cartes.length > 0 ">
      <div
        class="flex flex-row justify-between pl-3 pr-3 bg-white mb-5 shadow-[0px_3px_20px_#00000029] rounded-[18px] h-[120px] items-center"
        *ngFor="let item of cartes | paginate: { itemsPerPage: 5, currentPage: p }">
        <div class="width-info">
          <div class="flex items-center typecarte">
            <div class="pl-2 pr-2">
              <svg *ngIf="item.type == 'AUTOROUTE'" id="Group_10316" data-name="Group 10316"
                xmlns="http://www.w3.org/2000/svg" width="67.996" height="43.998" viewBox="0 0 67.996 43.998">
                <path id="Path_9212" data-name="Path 9212"
                  d="M22.4,31a5.5,5.5,0,0,1-9.8,0H12a2,2,0,0,1-2-2V20a2,2,0,0,1,1.717-1.98l6.032-.862,3.515-6.15A2,2,0,0,1,23,10H34a2,2,0,0,1,1.838,1.212L38.316,17H39a2,2,0,0,1,2,2V29a2,2,0,0,1-2,2H37.4a5.5,5.5,0,0,1-9.8,0Zm.393-4h4.414A5.5,5.5,0,0,1,37,25.336V21H19.141L14,21.734v2.522A5.5,5.5,0,0,1,22.792,27ZM17.5,30A1.5,1.5,0,1,0,16,28.5,1.5,1.5,0,0,0,17.5,30Zm15,0A1.5,1.5,0,1,0,31,28.5,1.5,1.5,0,0,0,32.5,30Zm.181-16H24.16l-1.715,3H33.964ZM6,0H62a6,6,0,0,1,6,6V38a6,6,0,0,1-6,6H6a6,6,0,0,1-6-6V6A6,6,0,0,1,6,0ZM6,4A2,2,0,0,0,4,6V38a2,2,0,0,0,2,2H62a2,2,0,0,0,2-2V6a2,2,0,0,0-2-2ZM48,22a2,2,0,1,1,2,2A2,2,0,0,1,48,22Zm0-10a2,2,0,1,1,2,2A2,2,0,0,1,48,12Zm0,20a2,2,0,1,1,2,2A2,2,0,0,1,48,32Z" />
              </svg>
              <svg *ngIf="item.type == 'EASY_ONE'" xmlns="http://www.w3.org/2000/svg" width="62.788" height="44.849"
                viewBox="0 0 62.788 44.849">
                <path id="icons8-magnetic_card"
                  d="M8.727,6A6.763,6.763,0,0,0,2,12.727V44.121a6.763,6.763,0,0,0,6.727,6.727H58.061a6.763,6.763,0,0,0,6.727-6.727V12.727A6.763,6.763,0,0,0,58.061,6Zm0,4.485H58.061A2.2,2.2,0,0,1,60.3,12.727v4.485H8.727V21.7H60.3V44.121a2.2,2.2,0,0,1-2.242,2.242H8.727a2.2,2.2,0,0,1-2.242-2.242V12.727A2.2,2.2,0,0,1,8.727,10.485Z"
                  transform="translate(-2 -6)" />
              </svg>
              <svg *ngIf="item.type == 'GAZOILE'" xmlns="http://www.w3.org/2000/svg" width="65.241" height="62"
                viewBox="0 0 65.241 62">
                <g id="Group_10315" data-name="Group 10315" transform="translate(-7.563 -12)">
                  <path id="Path_9209" data-name="Path 9209"
                    d="M79.442,27.959V27.84L77.058,17.705a1.192,1.192,0,0,0-.322-.566L71.967,12.37a1.192,1.192,0,0,0-1.681,1.681l4.525,4.531.9,3.821c-.3.233-3.8,1.246-4.322,5.187,0,.125-.262,3.058-.262,4.1,0,1.729,1.5,2.981,3.577,2.981h2.385V68.056a3.577,3.577,0,1,1-7.154,0V47.173A13.712,13.712,0,0,0,57.385,33.515V13.192A1.192,1.192,0,0,0,56.192,12h-31A1.192,1.192,0,0,0,24,13.192V41.212a1.192,1.192,0,0,0,2.385,0V14.385H55V71.615H25.192a1.192,1.192,0,0,0,0,2.385h31a1.192,1.192,0,0,0,1.192-1.192v-36.9A11.327,11.327,0,0,1,67.519,47.173V68.038a5.962,5.962,0,0,0,11.923,0Zm-4.769,4.31c-.495,0-1.192-.185-1.192-.6,0-.781.179-3.082.244-3.845a3.845,3.845,0,0,1,2.516-3.058l.817,3.464v4.036Z"
                    transform="translate(-6.638)" />
                  <path id="Path_9210" data-name="Path 9210"
                    d="M43.593,41.077a1.192,1.192,0,0,0,1.192-1.192V23.192A1.192,1.192,0,0,0,43.593,22H24.516a1.192,1.192,0,0,0-1.192,1.192V39.885a1.192,1.192,0,0,0,1.192,1.192ZM25.708,24.385H42.4V38.692H25.708ZM19.657,72.929l19.166-10.1a3.9,3.9,0,0,0,1.628-5.288L34.12,45.459a3.917,3.917,0,0,0-5.282-1.645L9.648,53.948A3.9,3.9,0,0,0,8.02,59.236l6.361,12.042a3.917,3.917,0,0,0,5.276,1.651Zm-3.172-2.76L10.131,58.091a1.52,1.52,0,0,1,.626-2.063l19.19-10.135a1.532,1.532,0,0,1,2.063.656l6.355,12.1a1.52,1.52,0,0,1-.6,2.069l-19.214,10.1a1.526,1.526,0,0,1-2.069-.65Z"
                    transform="translate(0 -4.038)" />
                  <path id="Path_9211" data-name="Path 9211"
                    d="M27.779,63.984l-2.23-4.239a1.192,1.192,0,0,0-1.616-.531l-5.1,2.683a1.192,1.192,0,0,0-.5,1.616l2.236,4.233a1.192,1.192,0,0,0,1.61.5l5.1-2.683a1.192,1.192,0,0,0,.5-1.58Zm-5.652,1.61-1.121-2.128,2.981-1.574,1.121,2.128ZM42.134,35.631c-.25-2.522-2.665-5-2.945-5.276a1.192,1.192,0,0,0-1.681,0c-.28.274-2.695,2.754-2.945,5.276a3.786,3.786,0,1,0,7.571,0Zm-3.786,1.526c-.733,0-1.484-.6-1.413-1.288a6.373,6.373,0,0,1,1.413-2.856,6.373,6.373,0,0,1,1.413,2.856C39.833,36.561,39.082,37.157,38.349,37.157Zm-9.622,21.6a3.577,3.577,0,0,1,2.3,4.358,1.192,1.192,0,1,0,2.319.548,5.962,5.962,0,0,0-3.75-7.154,1.193,1.193,0,0,0-.864,2.224Zm3.064-3.482a6.677,6.677,0,0,1,3.839,7.291,1.206,1.206,0,1,0,2.385.364,9.1,9.1,0,0,0-5.163-9.807,1.2,1.2,0,1,0-1.061,2.152Z"
                    transform="translate(-4.294 -7.273)" />
                </g>
              </svg>
              <svg *ngIf="item.type == 'JAWAZ'" id="Component_2334_10" data-name="Component 2334 – 10"
                xmlns="http://www.w3.org/2000/svg" width="66" height="50.061" viewBox="0 0 66 50.061">
                <g id="Rectangle_3750" data-name="Rectangle 3750" fill="none" stroke="#000" stroke-width="3">
                  <rect width="66" height="44" rx="6" stroke="none" />
                  <rect x="1.5" y="1.5" width="63" height="41" rx="4.5" fill="none" />
                </g>
                <g id="Group_10317" data-name="Group 10317" transform="translate(24.613 1.668)">
                  <text id="J" transform="translate(3.217 33.392)" font-size="24" font-family="Khula-Bold, Khula"
                    font-weight="700">
                    <tspan x="0" y="0">J</tspan>
                  </text>
                  <path id="Path_9213" data-name="Path 9213" d="M.438,0H.6A3.13,3.13,0,0,1,3.823,3.034V4.81H.438Z"
                    transform="translate(4.856 12.141)" />
                  <path id="icons8-wi-fi"
                    d="M7.065.014A9.03,9.03,0,0,0,0,2.711L.9,3.72A7.974,7.974,0,0,1,7.131,1.355a9.9,9.9,0,0,1,6.494,3.04l.807-.939A11.282,11.282,0,0,0,7.065.014ZM7.23,3.366A6.38,6.38,0,0,0,2.242,5.3l.9,1.009A5.258,5.258,0,0,1,7.3,4.707a6.847,6.847,0,0,1,4.351,2.069l.767-.962A8.142,8.142,0,0,0,7.23,3.366Zm.165,3.352a3.835,3.835,0,0,0-2.914,1.1l.885,1.029a2.7,2.7,0,0,1,2.1-.787A3.318,3.318,0,0,1,9.645,9.073l.788-.94A4.728,4.728,0,0,0,7.395,6.718ZM7.56,10.07a1.3,1.3,0,0,0-.859.289l.925,1.052.826-.959A1.58,1.58,0,0,0,7.56,10.07Z"
                    transform="matrix(0.891, 0.454, -0.454, 0.891, 4.648, 0.393)" />
                </g>
              </svg>
            </div>
          </div>
        </div>
        <mat-divider [vertical]="true" class="mx-auto"></mat-divider>
        <div class="width-content">
          <div class="flex items-center">
            <div class="pl-3">
              <p class="text-[#b5b5b5] text-[10px]">Sous parc</p>
              <p class="text-[12px] text-[#000000]">{{ item.parc?.name }}</p>
            </div>
          </div>
          <div class="flex items-center">
            <div class="pl-3">
              <p class="text-[#b5b5b5] text-[10px]">Fournisseur</p>
              <p class="text-[12px] text-[#000000]">{{ item.prestataire?.name }}</p>
            </div>
          </div>
        </div>
        <mat-divider [vertical]="true" class="mx-auto"></mat-divider>
        <div class="width-content">
          <div class="flex items-center">
            <div class="pl-3">
              <p class="text-[#b5b5b5] text-[10px]">N° carte</p>
              <p class="text-[12px] text-[#000000]">{{ item.n_carte }}</p>
            </div>
          </div>
          <div class="flex items-center">
            <div class="pl-3">
              <p class="text-[#b5b5b5] text-[10px]">Service</p>
              <p class="text-[12px] text-[#000000]">{{ item.service?.name }}</p>
            </div>
          </div>
        </div>
        <mat-divider [vertical]="true" class="mx-auto"></mat-divider>
        <div class="width-content">
          <div class="flex items-center">
            <div class="pl-3">
              <p class="text-[#b5b5b5] text-[10px]">Commentaire</p>
              <div class="flex">
                <p class="text-[12px] text-[#000000]">{{ item.libelle }}</p>
              </div>
            </div>
          </div>
          <div class="flex items-center">
            <div class="pl-3">
              <p class="text-[#b5b5b5] text-[10px]">Type d’affectation</p>
              <div class="flex">
                <p class="text-[12px] text-[#000000]">
                  {{ item.affectations['0']?.type_affectation }}
                </p>
              </div>
            </div>
          </div>
        </div>
        <mat-divider [vertical]="true" class="mx-auto"></mat-divider>
        <div class="width-content">
          <div class="flex items-center">
            <div class="pl-3">
              <p class="text-[#b5b5b5] text-[10px]">Type de carte</p>
              <div class="flex">
                <p class="text-[12px] text-[#000000]">{{ item.type }}</p>
              </div>
            </div>
          </div>
          <div class="flex items-center">
            <div class="pl-3">
              <p class="text-[#b5b5b5] text-[10px]">Statut</p>
              <div class="flex">
                <p class="text-[12px] text-[#000000]">
                  {{ item.status == false ? "Innactif" : "" }}
                  {{ item.status == true ? "Actif" : "" }}
                </p>
              </div>
            </div>
          </div>
        </div>
        <mat-divider [vertical]="true" class="mx-auto"></mat-divider>
        <div class="width-content">
          <div class="flex items-center">
            <div class="pl-3">
              <p class="text-[#b5b5b5] text-[10px]">Date début</p>
              <div class="flex">
                <p class="text-[12px] text-[#000000]">{{ item.start_date | date: 'dd/MM/yyyy'}}</p>
              </div>
            </div>
          </div>
          <div class="flex items-center">
            <div class="pl-3">
              <p class="text-[#b5b5b5] text-[10px]">Date fin</p>
              <div class="flex">
                <p class="text-[12px] text-[#000000]">{{ item.end_date | date: 'dd/MM/yyyy'}}</p>
              </div>
            </div>
          </div>
        </div>
        <mat-divider [vertical]="true" class="mx-auto"></mat-divider>
        <div class="width-content">
          <div class="flex items-center">
            <div class="pl-3">
              <p class="text-[#b5b5b5] text-[10px]">Solde</p>
              <div class="flex">
                <p class="text-[12px] text-[#000000]">{{ formatNumber(item.solde) }} DH</p>
              </div>
            </div>
          </div>
          <div class="flex items-center">
            <div class="pl-3">
              <p class="text-[#b5b5b5] text-[10px]">Montant consommé</p>
              <div class="flex">
                <p class="text-[12px] text-[#000000]">{{ formatNumber(item.qte_consomme) }} DH</p>
              </div>
            </div>
          </div>
        </div>
        <mat-divider [vertical]="true" class="mx-auto"></mat-divider>
        <div class="width-content">
          <div class="flex items-center">
            <div class="pl-3">
              <p class="text-[#b5b5b5] text-[10px]">Plafond </p>
              <div class="flex">
                <p class="text-[12px] text-[#000000]">{{ formatNumber(item.plafond) }} DH</p>
              </div>
            </div>
          </div>
          <div class="flex items-center">
            <div class="pl-3">
              <p class="text-[#b5b5b5] text-[10px]">Date d'affectation</p>
              <div class="flex">
                <p class="text-[12px] text-[#000000]">{{ item.affectations['0']?.start_date }}</p>
              </div>
            </div>
          </div>
        </div>
        <mat-divider [vertical]="true" class="mx-auto"></mat-divider>
        <div class="width-content">
          <div class="flex items-center">
            <div class="pl-3">
              <p class="text-[#b5b5b5] text-center">
                <mat-icon class="text-[30px]">payment</mat-icon>
                <mat-progress-bar mode="determinate" [value]="progress(item.solde, item.plafond)"></mat-progress-bar>
              </p>
              <div class="flex">
                <p class="text-[12px] text-[#000000]">
                  {{ formatNumber(item.solde) }} / {{ formatNumber(item.plafond) }} DH
                </p>
                <!-- <p class="text-[12px] text-[#000000]">{{ item.fournisseur }}</p> -->
              </div>
            </div>
          </div>
        </div>
        <mat-divider [vertical]="true" class="mx-auto"></mat-divider>
        <div class="width-content">
          <div class="flex items-center">
            <div class="pl-3">
              <button *ngIf="item.is_affected == false" class="text-white bg-red-400 px-3 py-2 rounded-[20px] mr-2">Non
                affectée </button>
              <button *ngIf="item.is_affected === true"
                class="text-white bg-green-500 px-3 py-2 rounded-[20px] mr-2">Affectée </button>
            </div>
          </div>
        </div>
        <div class="width-info">
          <div class="flex items-center pl-4 justify-end">
            <mat-icon mat-button [matMenuTriggerFor]="menu" class="cursor-pointer">more_vert</mat-icon>
          </div>

        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="rechargecarte(item)">
            Recharger La Carte
          </button>
          <button mat-menu-item (click)="ajouter('edit', item)" *ngIf="permissionService.hasPermission('Gestion de parc', 'Liste des cartes', 'U')">Modifier</button>
          <button mat-menu-item *ngIf="item.is_affected == false && permissionService.hasPermission('Gestion de parc', 'Liste des cartes', 'U')" (click)="affecte(item)">Affecter</button>
          <button mat-menu-item (click)="mouvementstockcartes(item.uuid)" *ngIf="permissionService.hasPermission('Gestion de parc', 'Liste des cartes', 'U')"> mouvement de la carte </button>
          <button mat-menu-item (click)="delet(item.uuid)" *ngIf="permissionService.hasPermission('Gestion de parc', 'Liste des cartes', 'D')"> Supprimer </button>
        </mat-menu>
        </div>
      </div>
      <div class="mt-10" *ngIf="!spinner && cartes.length!=0">
        <app-pagination [Links]="links" (getPage)="getTheNext($event)"></app-pagination>
      </div>
    </div>
  </div>
</div>
