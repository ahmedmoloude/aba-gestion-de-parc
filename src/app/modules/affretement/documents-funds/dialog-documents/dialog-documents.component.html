<div class="dialog">
  <div class="grid grid-cols-3 gap-4 bg-[#E9E9E9] rounded-[12px_12px_0px_0px] p-4">
    <h2 mat-dialog-title class="col-span-2">{{type=='Trait'? 'Traite': type}}</h2>
    <div class="text-right cursor-pointer" mat-button mat-dialog-close>
      <mat-icon>close</mat-icon>
    </div>
  </div>
  <div mat-dialog-content class="dialog-carte">
    <table class="w-full text-left text-gray-500 pl-3 pr-3">
      <thead>
        <tr>
          <th class="p-2 text-[#0C8040] font-normal whitespace-nowrap">N° Demande</th>
          <th class="p-2 text-[#0C8040] font-normal whitespace-nowrap">Référence</th>
          <th class="p-2 text-[#0C8040] font-normal whitespace-nowrap">Date de scan</th>
          <th class="p-2 text-[#0C8040] font-normal whitespace-nowrap">Date de récupération</th>
          <th class="p-2 text-[#0C8040] font-normal whitespace-nowrap">Date de remise</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let demande of historic| paginate: { itemsPerPage: 5, currentPage: p }; let i = index">
          <tr class="table-row bg-white whitespace-nowrap border-b border-gray-800">
            <td class="p-2" [attr.rowspan]="demande?.documents?.length > 0 ? demande.documents.length:1">{{demande?.demande || '---'}}</td>
            <td class="p-2">{{demande?.documents[0]?.reference || '---'}}</td>
            <td class="p-2">{{(demande?.documents[0]?.scanDate | date: 'dd/MM/yyyy') || '---'}}</td>
            <td class="p-2">{{(demande?.documents[0]?.recuperationDate | date: 'dd/MM/yyyy') || '---'}}</td>
            <td class="p-2">{{(demande?.documents[0]?.remiseDate | date: 'dd/MM/yyyy') || '---'}}</td>
          </tr>
          <tr *ngFor="let item of demande?.documents.slice(1)">
            <td class="p-2">{{item?.reference || '---'}}</td>
            <td class="p-2">{{(item?.scanDate | date: 'dd/MM/yyyy') || '---'}}</td>
            <td class="p-2">{{(item?.recuperationDate | date: 'dd/MM/yyyy') || '---'}}</td>
            <td class="p-2">{{(item?.remiseDate | date: 'dd/MM/yyyy') || '---'}}</td>
          </tr>
        </ng-container>
      </tbody>
    </table>
    <div class="mt-4 pl-3 pr-3" *ngIf="historicImages?.length > 0">
      <h5>Photos : </h5>
      <div class="grid grid-cols-8 gap-3 border p-5 rounded-lg">
        <div *ngFor="let image of historicImages; let index = index" key="index">
          <img [src]="image.thumbnailImageSrc" [title]="image.title" [alt]="image.alt" style="cursor: pointer" (click)="imageClick(index)" />
        </div>
      </div>
      <p-galleria [(value)]="historicImages" [(visible)]="displayCustom" [(activeIndex)]="activeIndex"
        [responsiveOptions]="responsiveOptions" [containerStyle]="{ 'max-width': '850px' }" [numVisible]="7"
        [circular]="true" [fullScreen]="true" [showItemNavigators]="true" [showThumbnails]="false">
        <ng-template pTemplate="item" let-item>
          <img [src]="item.itemImageSrc" [title]="item.title" style="width: 100%; display: block;" />
        </ng-template>
      </p-galleria>
    </div>
    <div class="mt-4 pl-3 pr-3" *ngIf="historicAttachments?.length > 0">
      <h5>Documents : </h5>
      <div class="grid grid-cols-4 gap-3 border p-5 rounded-lg">
        <div class="pdf" *ngFor="let item of historicAttachments">
          <a [href]="item?.url" target="_blank" class="flex items-center">
            <mat-icon class="pl-[5px] file-icon" style="padding-right: 24px;">attach_file</mat-icon>
            {{item.name}}
          </a>
        </div>
      </div>
    </div>
    <div class="mt-10">
      <pagination-controls (pageChange)="p = $event"></pagination-controls>
    </div>
  </div>
  <div class="grid grid-cols-2 gap-4 mt-2 mb-2 p-4">
    <div>
      <button mat-dialog-close class="underline w-32 p-4 mr-3 font-bold text-[18px]">
        Annuler
      </button>
    </div>
    <!-- <div class="text-right">
          <button type="submit"
            class="bg-[#0C8040] text-[#fff] border-[#0C8040] rounded-[28px] shadow-[0px_3px_6px_#00000029] w-32 p-4 mr-3 font-bold text-[18px]">
            Créer
          </button>
        </div> -->
  </div>
</div>
