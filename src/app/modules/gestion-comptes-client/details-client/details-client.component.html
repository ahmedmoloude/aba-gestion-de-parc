<div *ngIf="spinner" class="flex items-center justify-center mt-6 mb-6">
  <mat-spinner [diameter]="50"></mat-spinner>
</div>
<div class="bg-[#fff] shadow-[0px_3px_30px_#00000029] rounded-[20px] ml-6 mr-6 p-6" *ngIf="!spinner">

  <div class="border-t-2 border-[#F2FCF1] mt-5 mb-5"></div>
  <div class="cards w-[100%] pl-3 mt-6">
    <h3 class="font-medium">Sélectionnez les sous-panneaux à afficher</h3>
    <div class="grid grid-cols-2 sm:grid-cols-5 mb-5">
      <div class="mr-6 cursor-pointer">
        <mat-card (click)="relations('contact')" [class]="{ active: relation === 'contact' }">
          <mat-card-title
            [ngClass]="  relation === 'contact' ? 'text-[#fff] font-bold' : 'text-[#0C8040] font-bold' ">{{
            client?.contact_count }}</mat-card-title>
          <mat-card-subtitle [ngClass]="relation === 'contact' ? 'subtitleActive' : ''">Total</mat-card-subtitle>
          <mat-card-actions>
            <button mat-button>Contacts</button>
          </mat-card-actions>
        </mat-card>
      </div>
      <div class="mr-6 cursor-pointer">
        <mat-card (click)="relations('document')" [class]="{ active: relation === 'document' }">
          <mat-card-title
            [ngClass]=" relation === 'document' ? 'text-[#fff] font-bold' : 'text-[#0C8040] font-bold'">
            {{ client?.document_count }}
          </mat-card-title>
          <mat-card-subtitle [ngClass]="relation === 'document' ? 'subtitleActive' : ''">Total</mat-card-subtitle>
          <mat-card-actions>
            <button mat-button>Documents</button>
          </mat-card-actions>
        </mat-card>
      </div>
      <div class="mr-6 cursor-pointer">
        <mat-card (click)="relations('invoices')" [class]="{ active: relation === 'invoices' }">
          <mat-card-title [ngClass]="
              relation === 'invoices'
                ? 'text-[#fff] font-bold'
                : 'text-[#0C8040] font-bold' ">
            {{ client?.invoices_count }}</mat-card-title>
          <mat-card-subtitle [ngClass]="relation === 'invoices' ? 'subtitleActive' : ''">Total</mat-card-subtitle>
          <mat-card-actions>
            <button mat-button>Factures</button>
          </mat-card-actions>
        </mat-card>
      </div>
      <div class="mr-6 cursor-pointer">
        <mat-card (click)="relations('tache')" [class]="{ active: relation === 'tache' }">
          <mat-card-title [ngClass]="
              relation === 'tache'
                ? 'text-[#fff] font-bold'
                : 'text-[#0C8040] font-bold'
            ">{{ client?.tache_count }}</mat-card-title>
          <mat-card-subtitle [ngClass]="relation === 'tache' ? 'subtitleActive' : ''">Total</mat-card-subtitle>
          <mat-card-actions>
            <button mat-button>Tâches</button>
          </mat-card-actions>
        </mat-card>
      </div>
      <!--<div class="mr-6 cursor-pointer">
        <mat-card>
          <mat-card-title [ngClass]="relation==='offers' ? 'text-[#fff] font-bold' : 'text-[#0C8040] font-bold' ">{{ client?.contact_count }}</mat-card-title>
          <mat-card-subtitle>Total</mat-card-subtitle>
          <mat-card-actions>
            <button mat-button>Prospects</button>
          </mat-card-actions>
        </mat-card>
      </div>-->
    </div>
    <div class="grid grid-cols-2 sm:grid-cols-5">
      <div class="mr-6 cursor-pointer">
        <mat-card (click)="relations('expedition')" [class]="{ active: relation === 'expedition' }">
          <mat-card-title [ngClass]="
              relation === 'expedition'
                ? 'text-[#fff] font-bold'
                : 'text-[#0C8040] font-bold'
            ">{{ client?.expedition_count }}</mat-card-title>
          <mat-card-subtitle [ngClass]="relation === 'expedition' ? 'subtitleActive' : ''">Total</mat-card-subtitle>
          <mat-card-actions>
            <button mat-button>Expéditions</button>
          </mat-card-actions>
        </mat-card>
      </div>
      <div class="mr-6 cursor-pointer">
        <mat-card (click)="relations('offers')" [class]="{ active: relation === 'offers' }">
          <mat-card-title [ngClass]="
              relation === 'offers'
                ? 'text-[#fff] font-bold'
                : 'text-[#0C8040] font-bold'
            ">{{ client?.offers_count }}</mat-card-title>
          <mat-card-subtitle [ngClass]="relation === 'offers' ? 'subtitleActive' : ''">Total</mat-card-subtitle>
          <mat-card-actions>
            <button mat-button>Offre commerciales</button>
          </mat-card-actions>
        </mat-card>
      </div>
      <div class="mr-6 cursor-pointer">
        <mat-card (click)="relations('rdv')" [class]="{ active: relation === 'rdv' }">
          <mat-card-title [ngClass]="
              relation === 'rdv'
                ? 'text-[#fff] font-bold'
                : 'text-[#0C8040] font-bold'
            ">{{ client?.rdv_count }}</mat-card-title>
          <mat-card-subtitle [ngClass]="relation === 'rdv' ? 'subtitleActive' : ''">Total</mat-card-subtitle>
          <mat-card-actions>
            <button mat-button>Rendez-Vous</button>
          </mat-card-actions>
        </mat-card>
      </div>
      <div class="mr-6 cursor-pointer">
        <mat-card (click)="relations('reclamations')" [class]="{ active: relation === 'reclamations' }">
          <mat-card-title [ngClass]="
              relation === 'reclamations'
                ? 'text-[#fff] font-bold'
                : 'text-[#0C8040] font-bold'
            ">{{ client?.reclamations_count }}</mat-card-title>
          <mat-card-subtitle [ngClass]="relation === 'reclamations' ? 'subtitleActive' : ''">Total</mat-card-subtitle>
          <mat-card-actions>
            <button mat-button>Réclamations</button>
          </mat-card-actions>
        </mat-card>
      </div>
      <div class="mr-6 cursor-pointer">
        <mat-card (click)="relations('devis')" [class]="{ active: relation === 'devis' }">
          <mat-card-title [ngClass]="
              relation === 'devis'
                ? 'text-[#fff] font-bold'
                : 'text-[#0C8040] font-bold'
            ">{{ client?.devis_count }}</mat-card-title>
          <mat-card-subtitle [ngClass]="relation === 'devis' ? 'subtitleActive' : ''">Total</mat-card-subtitle>
          <mat-card-actions>
            <button mat-button>Devis</button>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>
  </div>
  <div *ngIf="spinnerTableau" class="flex items-center justify-center mt-6 mb-6">
    <mat-spinner [diameter]="50"></mat-spinner>
  </div>
  <ng-container *ngIf="!spinnerTableau">
    <div class="overflow-x-auto relative mt-8 pl-2 pr-7" *ngIf="relation == 'contact'">
      <table class="w-full text-left text-gray-500">
        <thead>
          <tr>
            <th *ngFor=" let header of headerColumuns | paginate : { itemsPerPage: 7, currentPage: page } " scope="col"
              class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex items-center"> {{ header }} </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="table-row bg-white whitespace-nowrap border-b border-gray-800"
            *ngFor="let item of detailsRelation">
            <td class="p-3">{{ item?.first_name }}</td>
            <td class="p-3">{{ item?.last_name }}</td>
            <td class="p-3">{{ client?.first_name }}</td>
            <td class="p-3">{{ item?.phone }}</td>
            <td class="p-3">{{ item?.email }}</td>
            <td class="p-3">{{ item?.fax }}</td>
            <td class="p-3">{{ item?.departement }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="overflow-x-auto relative mt-8 pl-2 pr-7" *ngIf="(relation == 'rdv' || relation == 'tache')">
      <table class="w-full text-left text-gray-500">
        <thead>
          <tr>
            <th *ngFor=" let header of headerColumunsRdvTask | paginate : { itemsPerPage: 8, currentPage: page } "
              scope="col" class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex items-center">
                {{ header }}
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="table-row bg-white whitespace-nowrap border-b border-gray-800"
            *ngFor="let item of detailsRelation">
            <td class="p-3">{{ item?.subject }}</td>
            <td class="p-3">{{ item?.startTime }}</td>
            <td class="p-3">{{ item?.endTime }}</td>
            <td class="p-3">{{ client?.first_name }}</td>
            <td class="p-3">{{ item?.user.name }}</td>
            <td class="p-3">{{ item?.priority }}</td>
            <td class="p-3" *ngIf="relation == 'rdv'">{{ item?.status }}</td>
            <td class="p-3" *ngIf="relation == 'tache'">
              {{ item?.status }}
            </td>
            <td class="p-3">{{ item?.type }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="overflow-x-auto relative mt-8 pl-2 pr-7" *ngIf="relation == 'devis'">
      <table class="w-full text-left text-gray-500">
        <thead>
          <tr>
            <th *ngFor=" let header of headerColumunsDevis | paginate : { itemsPerPage: 6, currentPage: page } "
              scope="col" class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex items-center">
                {{ header }}
              </div>
            </th>
            <th scope="col" class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex justify-end">Actions</div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="table-row bg-white whitespace-nowrap border-b border-gray-800"
            *ngFor=" let item of detailsRelation | paginate : { itemsPerPage: 6, currentPage: page } ">
            <td class="p-3">
              {{ item?.reference + "-" }}
              <span *ngIf="item?.last_version.length > 0" class="text-green">
                {{ "V" + item?.last_version[0].version }}
              </span>
            </td>
            <td class="p-3">
              {{ client?.first_name }}
            </td>
            <td class="p-3 flex">
              <span *ngIf="
                      item?.last_version.length > 0 &&
                      item?.last_version[0].status === 'DRAFT'
                    " class="text-white bg-orange-400 pl-3 pr-3 pt-1 pb-1 rounded-[20px] mr-2">Devis</span>
              <span *ngIf="
                      item?.last_version.length > 0 &&
                      item?.last_version[0].status === 'CREATED'
                    " class="text-white bg-[#728FCE] pl-3 pr-3 pt-1 pb-1 rounded-[20px] mr-2">Confirmé</span>
              <span *ngIf="
                      item?.last_version.length > 0 &&
                      item?.last_version[0].status === 'ACCEPTED'
                    " class="text-white bg-green-500 pl-3 pr-3 pt-1 pb-1 rounded-[20px] mr-2">Accepté</span>
              <span *ngIf="
                      item?.last_version.length > 0 &&
                      item?.last_version[0].status === 'REJECTED'
                    " class="text-white bg-red-400 pl-3 pr-3 pt-1 pb-1 rounded-[20px] mr-2">Non Accepté</span>
            </td>
            <td class="p-3">
              <span *ngIf="item?.last_version.length > 0">
                {{ item?.last_version[0].start_date }}</span>
            </td>
            <td class="p-3">
              <span *ngIf="item?.last_version.length > 0">
                {{ item?.last_version[0].end_date || "---" }}</span>
            </td>
            <td class="p-3">
              <button (click)="openQuotesHistoryDialog(item)" *ngIf="item?.versions.length > 0"
                class="bg-[#808080] text-[#fff] rounded-[10px] shadow-[0px_3px_6px_#00000029] w-18 px-3 pt-1 text-[12px]">
                <mat-icon class="p-O m-0">history</mat-icon>
              </button>
              <span *ngIf="item?.versions.length == 0"> --- </span>
            </td>
            <td class="p-3 text-right cursor-pointer">
              <ng-container *ngIf="item?.last_version.length > 0">
                <mat-icon mat-button [matMenuTriggerFor]="menu">more_vert</mat-icon>
                <mat-menu #menu="matMenu">
                  <button mat-menu-item (click)="showQuoteGridDetails(item?.last_version[0].uuid)">
                    <mat-icon>remove_red_eye</mat-icon>
                    Voir les conditions
                  </button>
                </mat-menu>
              </ng-container>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="overflow-x-auto relative mt-8 pl-2 pr-7" *ngIf="relation == 'offers'">
      <table class="w-full text-left text-gray-500">
        <thead>
          <tr>
            <th *ngFor=" let header of headerColumunsOffer | paginate : { itemsPerPage: 6, currentPage: page } "
              scope="col" class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex items-center">
                {{ header }}
              </div>
            </th>
            <th scope="col" class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex justify-end">Actions</div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="table-row bg-white whitespace-nowrap border-b border-gray-800"
            *ngFor="let item of detailsRelation">
            <td class="p-3">{{ item?.reference }}</td>
            <td class="p-3">{{ client?.first_name }}</td>
            <td class="p-3">{{ item?.start_date }}</td>
            <td class="p-3">{{ item?.end_date || "---" }}</td>
            <td class="p-3">{{ item?.service.name }}</td>
            <td class="p-3 text-right cursor-pointer">
              <div class="ml-3 cursor-pointer">
                <button mat-icon-button [matMenuTriggerFor]="menu">
                  <mat-icon class="cursor-pointer text-[22px] text-[#909090]">more_vert</mat-icon>
                </button>
              </div>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="detailsOffer(item?.uuid)">
                  <mat-icon>remove_red_eye</mat-icon>
                  <span>Details</span>
                </button>
              </mat-menu>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="overflow-x-auto relative mt-8 pl-2 pr-7" *ngIf="relation == 'expedition'">
      <table class="w-full text-left text-gray-500">
        <thead>
          <tr>
            <th
              *ngFor=" let header of headerColumunsExpeditions | paginate : {  itemsPerPage: 20,  currentPage: page } "
              scope="col" class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex items-center">
                {{ header }}
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="table-row bg-white whitespace-nowrap border-b border-gray-800" *ngFor="let exp of detailsRelation">
            <th scope="row" class="p-3 font-semibold text-gray-800 whitespace-nowrap">
              {{ exp.reference }}
            </th>
            <td>
              {{ exp.type_service.name }}
            </td>
            <td>{{ exp.id_receiver }}</td>
            <td>{{ exp.created_at | date: "dd/MM/yyyy" }}</td>
            <td>
              {{
              exp.customer.type === "entity"
              ? exp.customer.entreprise_name
              : exp.customer.first_name || exp.customer.last_name
              ? exp.customer.first_name + " " + exp.customer.last_name
              : exp.customer.name
              }}
            </td>
            <td>
              {{ exp.receiver.first_name }}
            </td>
            <td>{{ exp.city_expedition }} -> {{ exp.city_destination }}</td>
            <td>
              {{ exp.type_service?.name === "Messageries" ? exp.number : "-" }}
            </td>
            <td>
              {{ exp.type_service?.name === "Messageries" ? exp.weight : "-" }}
              kg
            </td>
            <td>{{ exp.declared_value }}</td>
            <td>
              {{ exp.type_service?.name === "Messageries" ? exp.volume : "-" }}
              m3
            </td>
            <td>{{ exp.type_delivery?.name }}</td>
            <td>{{ countRetourDocByType(exp, "BL") }}</td>
            <td>{{ countRetourDocByType(exp, "Facture") }}</td>
            <td>{{ exp.amount }} DH</td>
            <td>--</td>
            <td>{{ exp?.return_funds_amount }} DH</td>
            <td>{{ exp.nature }}</td>
            <td>{{ exp.mode_port }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="overflow-x-auto relative mt-8 pl-2 pr-7" *ngIf="relation == 'reclamations'">
      <table class="w-full text-left text-gray-500">
        <thead>
          <tr>
            <th
              *ngFor=" let header of headerColumunsReclamations | paginate  : { itemsPerPage: 8, currentPage: page }  "
              scope="col" class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex items-center">
                {{ header }}
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="table-row bg-white whitespace-nowrap border-b border-gray-800"
            *ngFor="let item of detailsRelation">
            <td>{{ item?.reference }}</td>
            <td class="p-3">{{ detailsComplaint[item?.type]["label"] }}</td>
            <td></td>
            <td>{{ item?.object }}</td>
            <td class="p-3">
              <div [class]="'badge ' + statusValues[item?.status]['color']">
                {{ statusValues[item?.status]["name"] }}
              </div>
            </td>
            <td>{{ item?.created_at | date: "dd/MM/yyyy" }}</td>
            <td>{{ item?.updated_at | date: "dd/MM/yyyy" }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="overflow-x-auto relative mt-8 pl-2 pr-7" *ngIf="relation == 'document'">
      <table class="w-full text-left text-gray-500">
        <thead>
          <tr>
            <th *ngFor=" let header of headerColumunsDocuments | paginate : { itemsPerPage: 12, currentPage: page } "
              scope="col" class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex items-center">
                {{ header }}
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="table-row bg-white whitespace-nowrap border-b border-gray-800"
            *ngFor="let item of detailsRelation">
            <th scope="row" class="p-3 font-semibold text-gray-900 whitespace-nowrap">
              {{ item?.documentable.reference }}
            </th>
            <td class="p-3">
              {{ item?.created_at | date: "dd/MM/y HH:mm" | if_null }}
            </td>
            <td class="p-3"></td>
            <td class="p-3">Null</td>
            <td class="p-3">{{ item?.documentable.nature }}</td>
            <td class="p-3">{{ item?.documentable?.return_funds_amount }} DH</td>
            <td class="p-3">{{ item?.documentable.mode_port }}</td>
            <td class="p-3">{{ NULL }}</td>
            <td class="p-3">{{ item?.type }}</td>
            <td class="p-3">{{ item?.documentable.status }}</td>
            <!-- <td class="p-3">
              <div [class]="
                'badge ' + statusValuesDocument[item?.documentable.status]['color']
              ">
                {{ statusValuesDocument[item?.documentable.status]["name"] }}
              </div>
            </td> -->
          </tr>
        </tbody>
      </table>
    </div>

    <div class="mt-10" *ngIf="(relation == 'contact' || relation == 'rdv' || relation == 'tache' || relation == 'devis'|| relation == 'offers' || relation == 'expedition' || relation == 'reclamations' || relation == 'document')">
      <pagination-controls (pageChange)="page = $event"></pagination-controls>
    </div>
  </ng-container>
  <!-- <div class="overflow-x-auto relative mt-8 pl-2 pr-7">
    <div *ngIf="!spinnerTableau && relation == 'contact'">
      <table class="w-full text-left text-gray-500">
        <thead>
          <tr>
            <th *ngFor=" let header of headerColumuns | paginate : { itemsPerPage: 7, currentPage: page } " scope="col"
              class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex items-center"> {{ header }} </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="table-row bg-white whitespace-nowrap border-b border-gray-800"
            *ngFor="let item of detailsRelation">
            <td class="p-3">{{ item?.first_name }}</td>
            <td class="p-3">{{ item?.last_name }}</td>
            <td class="p-3">{{ client?.first_name }}</td>
            <td class="p-3">{{ item?.phone }}</td>
            <td class="p-3">{{ item?.email }}</td>
            <td class="p-3">{{ item?.fax }}</td>
            <td class="p-3">{{ item?.departement }}</td>
          </tr>
        </tbody>
      </table>
      <div class="mt-10">
        <pagination-controls (pageChange)="page = $event"></pagination-controls>
      </div>
    </div>

    <div *ngIf="!spinnerTableau && (relation == 'rdv' || relation == 'tache')">
      <table class="w-full text-left text-gray-500">
        <thead>
          <tr>
            <th *ngFor="
                let header of headerColumunsRdvTask
                  | paginate
                    : {
                        itemsPerPage: 8,
                        currentPage: page
                      }
              " scope="col" class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex items-center">
                {{ header }}
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="table-row bg-white whitespace-nowrap border-b border-gray-800"
            *ngFor="let item of detailsRelation">
            <td class="p-3">{{ item?.subject }}</td>
            <td class="p-3">{{ item?.startTime }}</td>
            <td class="p-3">{{ item?.endTime }}</td>
            <td class="p-3">{{ client?.first_name }}</td>
            <td class="p-3">{{ item?.user.name }}</td>
            <td class="p-3">{{ item?.priority }}</td>
            <td class="p-3" *ngIf="relation == 'rdv'">{{ item?.status }}</td>
            <td class="p-3" *ngIf="relation == 'tache'">
              {{ item?.status }}
            </td>
            <td class="p-3">{{ item?.type }}</td>
          </tr>
        </tbody>
      </table>
      <div class="mt-10">
        <pagination-controls (pageChange)="page = $event"></pagination-controls>
      </div>
    </div>

    <div *ngIf="!spinnerTableau && relation == 'devis'">
      <table class="w-full text-left text-gray-500">
        <thead>
          <tr>
            <th *ngFor="
                let header of headerColumunsDevis
                  | paginate
                    : {
                        itemsPerPage: 6,
                        currentPage: page
                      }
              " scope="col" class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex items-center">
                {{ header }}
              </div>
            </th>
            <th scope="col" class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex justify-end">Actions</div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="table-row bg-white whitespace-nowrap border-b border-gray-800" *ngFor="
              let item of detailsRelation
                | paginate
                  : {
                      itemsPerPage: 6,
                      currentPage: page
                    }
            ">
            <td class="p-3">
              {{ item?.reference + "-" }}
              <span *ngIf="item?.last_version.length > 0" class="text-green">
                {{ "V" + item?.last_version[0].version }}
              </span>
            </td>
            <td class="p-3">
              {{ client?.first_name }}
            </td>
            <td class="p-3 flex">
              <span *ngIf="
                  item?.last_version.length > 0 &&
                  item?.last_version[0].status === 'DRAFT'
                " class="text-white bg-orange-400 pl-3 pr-3 pt-1 pb-1 rounded-[20px] mr-2">Devis</span>
              <span *ngIf="
                  item?.last_version.length > 0 &&
                  item?.last_version[0].status === 'CREATED'
                " class="text-white bg-[#728FCE] pl-3 pr-3 pt-1 pb-1 rounded-[20px] mr-2">Confirmé</span>
              <span *ngIf="
                  item?.last_version.length > 0 &&
                  item?.last_version[0].status === 'ACCEPTED'
                " class="text-white bg-green-500 pl-3 pr-3 pt-1 pb-1 rounded-[20px] mr-2">Accepté</span>
              <span *ngIf="
                  item?.last_version.length > 0 &&
                  item?.last_version[0].status === 'REJECTED'
                " class="text-white bg-red-400 pl-3 pr-3 pt-1 pb-1 rounded-[20px] mr-2">Non Accepté</span>
            </td>
            <td class="p-3">
              <span *ngIf="item?.last_version.length > 0">
                {{ item?.last_version[0].start_date }}</span>
            </td>
            <td class="p-3">
              <span *ngIf="item?.last_version.length > 0">
                {{ item?.last_version[0].end_date || "---" }}</span>
            </td>
            <td class="p-3">
              <button (click)="openQuotesHistoryDialog(item)" *ngIf="item?.versions.length > 0"
                class="bg-[#808080] text-[#fff] rounded-[10px] shadow-[0px_3px_6px_#00000029] w-18 px-3 pt-1 text-[12px]">
                <mat-icon class="p-O m-0">history</mat-icon>
              </button>
              <span *ngIf="item?.versions.length == 0"> --- </span>
            </td>
            <td class="p-3 text-right cursor-pointer">
              <ng-container *ngIf="item?.last_version.length > 0">
                <mat-icon mat-button [matMenuTriggerFor]="menu">more_vert</mat-icon>
                <mat-menu #menu="matMenu">
                  <button mat-menu-item (click)="showQuoteGridDetails(item?.last_version[0].uuid)">
                    <mat-icon>remove_red_eye</mat-icon>
                    Voir les conditions
                  </button>
                </mat-menu>
              </ng-container>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="mt-10">
        <pagination-controls (pageChange)="page = $event"></pagination-controls>
      </div>
    </div>

    <div *ngIf="!spinnerTableau && relation == 'offers'">
      <table class="w-full text-left text-gray-500">
        <thead>
          <tr>
            <th *ngFor="
                let header of headerColumunsOffer
                  | paginate
                    : {
                        itemsPerPage: 6,
                        currentPage: page
                      }
              " scope="col" class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex items-center">
                {{ header }}
              </div>
            </th>
            <th scope="col" class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex justify-end">Actions</div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="table-row bg-white whitespace-nowrap border-b border-gray-800"
            *ngFor="let item of detailsRelation">
            <td class="p-3">{{ item?.reference }}</td>
            <td class="p-3">{{ client?.first_name }}</td>
            <td class="p-3">{{ item?.start_date }}</td>
            <td class="p-3">{{ item?.end_date || "---" }}</td>
            <td class="p-3">{{ item?.service.name }}</td>
            <td class="p-3 text-right cursor-pointer">
              <div class="ml-3 cursor-pointer">
                <button mat-icon-button [matMenuTriggerFor]="menu">
                  <mat-icon class="cursor-pointer text-[22px] text-[#909090]">more_vert</mat-icon>
                </button>
              </div>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="detailsOffer(item?.uuid)">
                  <mat-icon>remove_red_eye</mat-icon>
                  <span>Details</span>
                </button>
              </mat-menu>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="mt-10">
        <pagination-controls (pageChange)="page = $event"></pagination-controls>
      </div>
    </div>

    <div *ngIf="!spinnerTableau && relation == 'expedition'">
      <table class="w-full text-left text-gray-500">
        <thead>
          <tr>
            <th *ngFor="
                let header of headerColumunsExpeditions
                  | paginate
                    : {
                        itemsPerPage: 20,
                        currentPage: page
                      }
              " scope="col" class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex items-center">
                {{ header }}
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="table-row bg-white whitespace-nowrap border-b border-gray-800" *ngFor="let exp of detailsRelation">
            <th scope="row" class="p-3 font-semibold text-gray-800 whitespace-nowrap">
              {{ exp.reference }}
            </th>
            <td>
              {{ exp.type_service.name }}
            </td>
            <td>{{ exp.id_receiver }}</td>
            <td>{{ exp.created_at | date: "dd/MM/yyyy" }}</td>
            <td>
              {{
              exp.customer.type === "entity"
              ? exp.customer.entreprise_name
              : exp.customer.first_name || exp.customer.last_name
              ? exp.customer.first_name + " " + exp.customer.last_name
              : exp.customer.name
              }}
            </td>
            <td>
              {{ exp.receiver.first_name }}
            </td>
            <td>{{ exp.city_expedition }} -> {{ exp.city_destination }}</td>
            <td>
              {{ exp.type_service?.name === "Messageries" ? exp.number : "-" }}
            </td>
            <td>
              {{ exp.type_service?.name === "Messageries" ? exp.weight : "-" }}
              kg
            </td>
            <td>{{ exp.declared_value }}</td>
            <td>
              {{ exp.type_service?.name === "Messageries" ? exp.volume : "-" }}
              m3
            </td>
            <td>{{ exp.type_delivery?.name }}</td>
            <td>{{ countRetourDocByType(exp, "BL") }}</td>
            <td>{{ countRetourDocByType(exp, "Facture") }}</td>
            <td>{{ exp.amount }} DH</td>
            <td>--</td>
            <td>{{ exp?.return_funds_amount }} DH</td>
            <td>{{ exp.nature }}</td>
            <td>{{ exp.mode_port }}</td>
          </tr>
        </tbody>
      </table>
      <div class="mt-10">
        <pagination-controls (pageChange)="page = $event"></pagination-controls>
      </div>
    </div>

    <div *ngIf="!spinnerTableau && relation == 'reclamations'">
      <table class="w-full text-left text-gray-500">
        <thead>
          <tr>
            <th *ngFor="
                let header of headerColumunsReclamations
                  | paginate
                    : {
                        itemsPerPage: 8,
                        currentPage: page
                      }
              " scope="col" class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex items-center">
                {{ header }}
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="table-row bg-white whitespace-nowrap border-b border-gray-800"
            *ngFor="let item of detailsRelation">
            <td>{{ item?.reference }}</td>
            <td class="p-3">{{ detailsComplaint[item?.type]["label"] }}</td>
            <td></td>
            <td>{{ item?.object }}</td>
            <td class="p-3">
              <div [class]="'badge ' + statusValues[item?.status]['color']">
                {{ statusValues[item?.status]["name"] }}
              </div>
            </td>
            <td>{{ item?.created_at | date: "dd/MM/yyyy" }}</td>
            <td>{{ item?.updated_at | date: "dd/MM/yyyy" }}</td>
          </tr>
        </tbody>
      </table>
      <div class="mt-10">
        <pagination-controls (pageChange)="page = $event"></pagination-controls>
      </div>
    </div>

    <div *ngIf="!spinnerTableau && relation == 'document'">
      <table class="w-full text-left text-gray-500">
        <thead>
          <tr>
            <th *ngFor="
                let header of headerColumunsDocuments
                  | paginate
                    : {
                        itemsPerPage: 12,
                        currentPage: page
                      }
              " scope="col" class="p-3 text-[#0C8040] font-normal whitespace-nowrap">
              <div class="flex items-center">
                {{ header }}
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="table-row bg-white whitespace-nowrap border-b border-gray-800"
            *ngFor="let item of detailsRelation">
            <th scope="row" class="p-3 font-semibold text-gray-900 whitespace-nowrap">
              {{ item?.documentable.reference }}
            </th>
            <td class="p-3">
              {{ item?.created_at | date: "dd/MM/y HH:mm" | if_null }}
            </td>

            <td class="p-3"></td>
            <td class="p-3">Null</td>
            <td class="p-3">{{ item?.documentable.nature }}</td>
            <td class="p-3">{{ item?.documentable?.return_funds_amount }} DH</td>
            <td class="p-3">{{ item?.documentable.mode_port }}</td>
            <td class="p-3">{{ NULL }}</td>
            <td class="p-3">{{ item?.type }}</td>
            <td class="p-3">{{ item?.documentable.status }}</td>
          </tr>
        </tbody>
      </table>
      <div class="mt-10">
        <pagination-controls (pageChange)="page = $event"></pagination-controls>
      </div>
    </div>

  </div> -->
</div>
