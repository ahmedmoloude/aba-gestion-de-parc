<div class="dialog">
  <div
    class="grid grid-cols-3 gap-4 bg-[#E9E9E9] rounded-[12px_12px_0px_0px] p-4"
  >
    <h2 mat-dialog-title class="col-span-2">
      <ng-container *ngIf="this.dialogData.confirmed === 'accept-quote'">
        Approbation du devis par le client
      </ng-container>
      <ng-container *ngIf="this.dialogData.confirmed === 'decline-quote'">
        Refus du devis par le client
      </ng-container>
      <ng-container *ngIf="this.dialogData.confirmed === 'rollback-quote'">
        Refus de validation du devis
      </ng-container>
    </h2>
    <div class="text-right cursor-pointer" mat-button mat-dialog-close>
      <mat-icon>close</mat-icon>
    </div>
  </div>
  <form [formGroup]="quoteForm">
    <div mat-dialog-content>
      <!-- accept quote -->
      <ng-container *ngIf="this.dialogData.confirmed === 'accept-quote'">
        <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4">
          <mat-label>Date d'activation</mat-label>
          <input
            matInput
            [matDatepicker]="debut"
            (dateChange)="onDateSelection($event , 'start_date')"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="debut"
          ></mat-datepicker-toggle>
          <mat-datepicker #debut></mat-datepicker>
        </mat-form-field>
        <div
          *ngIf="submitted && f.start_date.errors"
          class="pl-8 pb-5 text-red-500"
        >
          <div *ngIf="f.start_date.errors.required">
            Vous devez choisissez une date d'activation
          </div>
        </div>
        <mat-checkbox
          class="example-margin"
          formControlName="end_date_check_box"
          name="date_expiration_enable"
          class="w-[100%] pl-9 pr-7 mb-4"
          >Date d’expiration</mat-checkbox
        >
        <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4">
          <mat-label>Date d’expiration</mat-label>
          <input
            matInput
            [min]="f.start_date.value"
            (dateChange)="onDateSelection($event , 'end_date')"
            [matDatepicker]="expiration"
            [disabled]="!f.end_date_check_box.value"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="expiration"
            [disabled]="!f.end_date_check_box.value"
          ></mat-datepicker-toggle>
          <mat-datepicker
            #expiration
            [disabled]="!f.end_date_check_box.value"
          ></mat-datepicker>
        </mat-form-field>
        <div
          *ngIf="submitted && f.end_date.errors"
          class="pl-8 pb-5 text-red-500"
        >
          <div *ngIf="f.end_date.errors.required">
            Vous devez choisir une date d’expiration
          </div>
        </div>
      </ng-container>

      <!-- decline or rollback quote -->
      <ng-container
        *ngIf="
          this.dialogData.confirmed === 'decline-quote' ||
          this.dialogData.confirmed === 'rollback-quote'
        "
      >
        <mat-form-field appearance="fill" class="w-[100%] pl-7 pr-7 mb-4 mt-4">
          <mat-label>Motif </mat-label>
          <textarea
            matInput
            rows="4"
            formControlName="motif"
            placeholder="Motif"
          ></textarea>
        </mat-form-field>
      </ng-container>
      <div class="flex mt-4 mb-4" *ngIf="this.dialogData.confirmed === 'accept-quote'">
        <div
          class="flex file-images flex-col justify-center items-center mt-4"
          *ngIf="attached_piece"
        >
          <button (click)="downloadDoc()" type="button">
            Visualiser le fichier
          </button>
          <mat-icon>cloud_download</mat-icon>
        </div>
        <div class="file-images flex mt-4" *ngIf="!attached_piece">
          <input
            #imgInput
            hidden="true"
            type="file"
            (change)="selectDoc($event)"
            accept="application/pdf"
          />
          <button mat-flat-button type="button" (click)="imgInput.click()">
            <mat-icon>add_circle</mat-icon>
            <p>
              Télécharger un fichier
            </p>
          </button>
        </div>
      </div>
    </div>
    <div *ngIf="loading" class="flex items-center justify-center p-5">
      <mat-spinner [diameter]="35"></mat-spinner>
    </div>
    <div *ngIf="!loading" class="grid grid-cols-2 gap-4 mt-2 mb-2 p-4">
      <div>
        <button
          class="underline w-32 p-4 mr-3 font-bold text-[18px]"
          mat-dialog-close
        >
          Abandonner
        </button>
      </div>
      <div class="text-right">
        <button
          (click)="onSubmit()"
          class="bg-[#0C8040] text-[#fff] border-[#0C8040] rounded-[28px] shadow-[0px_3px_6px_#00000029] w-32 p-4 mr-3 font-bold text-[18px]"
        >
          Enregister
        </button>
      </div>
    </div>
  </form>
</div>
