<div class="dialog">
  <div
    class="grid grid-cols-3 gap-4 bg-[#E9E9E9] rounded-[12px_12px_0px_0px] p-4"
  >
    <h2 mat-dialog-title class="col-span-2">Création d'un passage planifié</h2>
    <!-- <div class="text-right cursor-pointer" mat-button mat-dialog-close>
      <mat-icon>close</mat-icon>
    </div> -->
  </div>
  <div mat-dialog-content>
    <form class="mt-7 mb-7" [formGroup]="createPassage">
      <div class="grid grid-cols-1 sm:grid-cols-4 mb-4">
        <div>
          <div *ngIf="spinner" class="flex items-center justify-center mt-6 mb-6">
            <mat-spinner [diameter]="40"></mat-spinner>
          </div>

          <mat-form-field class="w-11/12 ml-3" appearance="fill">
            <mat-label>Client</mat-label>
            <input
              type="text"
              formControlName="customer_name"
              placeholder="Client"
              (ngModelChange)="modelChangeFn($event)"
              matInput
              [matAutocomplete]="auto"
            />
            <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
              <mat-option
                *ngFor="let option of clients"
                ng-show="isShown"
                (click)="to_fill(option, option)"
                class="cl_name"
                [ngValue]="option.id"
              >
                {{ option.name }}
              </mat-option>
            </mat-autocomplete>
          </mat-form-field>
          <!-- <div>
            <mat-form-field class="w-11/12 ml-3" appearance="fill" *ngIf="!spinner" >
              <mat-label>Client</mat-label>
              <mat-select matNativeControl required (selectionChange)="clientChange($event)" " >
                <mat-option *ngFor="let client of clients" value="{{ client.id }}" >
                  {{ client.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div> -->
        </div>
        <div>
          <mat-form-field class="w-11/12" appearance="fill">
            <mat-label>Date de début</mat-label>
            <input
              matInput
              [matDatepicker]="picker"
              formControlName="start_date"
            />
            <mat-datepicker-toggle
              matSuffix
              [for]="picker"
            ></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
        </div>
        <div>
          <mat-form-field class="w-11/12" appearance="fill">
            <mat-label>Date de fin</mat-label>
            <input
              matInput
              [matDatepicker]="pickers"
              formControlName="end_date"
            />
            <mat-datepicker-toggle
              matSuffix
              [for]="pickers"
            ></mat-datepicker-toggle>
            <mat-datepicker #pickers></mat-datepicker>
          </mat-form-field>
        </div>
        <div>
          <mat-form-field
            class="w-11/12"
            appearance="fill"
            *ngIf="adresseSpinner"
          >
            <mat-label>Adresse de ramassage</mat-label>
            <mat-select
              matNativeControl
              required
              formControlName="pickup_address_id"
            >
              <mat-option
                *ngFor="let adresse of addresses"
                value="{{ adresse.id }}"
              >
                {{ adresse.adress }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <section formArrayName="days" class="block mt-5 mb-5">
        <ng-container *ngFor="let day of days.controls; let idx1 = index">
          <ng-container [formGroupName]="idx1">
            <div class="ml-3 mb-3">
              <mat-checkbox
                class="example-margin"
                formControlName="checkbox"
                (change)="onChangeDemo($event)"
              >
                {{ days.value[idx1].name }}
              </mat-checkbox>
            </div>
            <div class="ml-3">
              <ng-container *ngFor="let hour of days.value[idx1].hours">
                <mat-form-field
                  class="example-full-width mr-3 mb-3"
                  appearance="fill"
                >
                  <mat-label>Heure de ramassage</mat-label>
                  <input
                    matInput
                    type="time"
                    [(ngModel)]="hour.value"
                    [ngModelOptions]="{ standalone: true }"
                    [disabled]="!days.value[idx1].checkbox"
                  />
                </mat-form-field>
              </ng-container>
            </div>
            <div
              class="ml-3"
              (click)="addHour(idx1)"
              *ngIf="days.value[idx1].checkbox"
            >
              <mat-icon class="text-[#0C8040] cursor-pointer"
                >add_circle</mat-icon
              >
            </div>
            <!--<div class="ml-3" (click)="removeHour(idx1)" *ngIf="isChecked">
            <mat-icon class="text-[#0C8040] cursor-pointer">add_circle</mat-icon>
          </div>-->
          </ng-container>
        </ng-container>
      </section>

      <!--<section class="flex items-center mt-5 mb-5">
      <div class="ml-3">
        <mat-checkbox class="example-margin" (change)="onChangeDemo($event, '2')">Mardi</mat-checkbox>
      </div>
      <div class="ml-3">
        <mat-form-field class="example-full-width" appearance="fill">
          <mat-label>Heure de ramassage</mat-label>
          <input matInput type="time" [disabled]="!isChecked"/>
        </mat-form-field>
      </div>
      <div class="ml-3">
        <mat-icon class="text-[#0C8040] cursor-pointer">add_circle</mat-icon>
      </div>
    </section>
     <section class="flex items-center mt-5 mb-5">
      <div class="ml-3">
        <mat-checkbox class="example-margin">Mercredi</mat-checkbox>
      </div>
    </section>
    <section class="flex items-center mt-5 mb-5">
      <div class="ml-3">
        <mat-checkbox class="example-margin">Jeudi</mat-checkbox>
      </div>
      <div class="ml-3">
        <mat-form-field class="example-full-width" appearance="fill">
          <mat-label>Heure de ramassage</mat-label>
          <input matInput type="time"/>
        </mat-form-field>
      </div>
      <div class="ml-3">
        <mat-icon class="text-[#0C8040] cursor-pointer">add_circle</mat-icon>
      </div>
    </section>
    <section class="flex items-center mt-5 mb-5">
      <div class="ml-3">
        <mat-checkbox class="example-margin">Vendredi</mat-checkbox>
      </div>
    </section>
    <section class="flex items-center mt-5 mb-5">
      <div class="ml-3">
        <mat-checkbox class="example-margin">Samedi</mat-checkbox>
      </div>
    </section> -->
      <div class="grid grid-cols-2 gap-4 mt-5 mb-5 p-4">
        <div>
          <button
            class="underline w-32 p-4 mr-3 font-bold text-[18px]"
            mat-dialog-close
          >
          Abondonner
          </button>
        </div>
        <div class="text-right">
          <div
            *ngIf="spinnerAdd"
            class="flex items-center justify-center mt-6 mb-6"
          >
            <mat-spinner [diameter]="50"></mat-spinner>
          </div>
          <!-- <button
            *ngIf="!spinnerAdd"
            class="bg-[#0C8040] text-[#fff] border-[#0C8040] rounded-[28px] shadow-[0px_3px_6px_#00000029] w-32 p-4 mr-3 font-bold text-[18px]"
            type="submit"
            [disabled]="createPassage.invalid"
            (click)="addPassage()" >
            Enregistrer
          </button> -->
          <button *ngIf="!spinnerAdd" [disabled]="createPassage.invalid" (click)="addPassage()" pButton pRipple type="submit" label="Enregistrer" class="p-button-rounded p-button-success"></button>
        </div>
      </div>
    </form>
  </div>
</div>
